# This is a basic workflow to help you get started with Actions

name: MLOps test

# Controls when the workflow will run
on:
  workflow_dispatch:
   
  
env:
  CLIENT_SECRET: ${{ secrets.CLIENT_SECRET }}

  WORKDIR: ${{github.workspace}}
  GIT_SHA: ${{ github.sha }} # Set the SHA to use in the code
  
jobs:

  data-preparing:
    runs-on: ubuntu-20.04 # Because of issues with dotnet, we downgraded this one
   
    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v2

      - name: add extension by name
        run: az extension add --name ml

      - name: azure login  
        run: az login --service-principal -u ${{ secrets.CLIENT_ID }} -p ${{ secrets.CLIENT_SECRET }} --tenant ${{ secrets.TENANT_ID }}
      
      - name: set default workspace
        continue-on-error: true  
        run: az configure --defaults group=mlops-bart workspace=diabetes-prediction-v2
        
      - name: create environment
        continue-on-error: true  
        run: az ml environment create --file azureml-2.0-cli/config/diabetes-prediction-env.yml --version auto --set tags.git-sha=${{ env.GIT_SHA }}
